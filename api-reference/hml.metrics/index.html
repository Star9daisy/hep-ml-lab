
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../hml.methods/networks/mlps/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>hml.metrics - HEP ML Lab</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hml.metrics.MaxSignificance" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="HEP ML Lab" class="md-header__button md-logo" aria-label="HEP ML Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HEP ML Lab
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              hml.metrics
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="HEP ML Lab" class="md-nav__button md-logo" aria-label="HEP ML Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    HEP ML Lab
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introcution
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/generate_events/" class="md-nav__link">
        Generate events
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/create_datasets/" class="md-nav__link">
        Create datasets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/apply_methods/" class="md-nav__link">
        Apply methods
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hml.generators/" class="md-nav__link">
        hml.generators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hml.observables/" class="md-nav__link">
        hml.observables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hml.representations/" class="md-nav__link">
        hml.representations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hml.datasets/" class="md-nav__link">
        hml.datasets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hml.preprocessing/" class="md-nav__link">
        hml.preprocessing
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          hml.methods
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          hml.methods
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hml.methods/cuts/" class="md-nav__link">
        Cuts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hml.methods/trees/" class="md-nav__link">
        Trees
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6_3" id="__nav_3_6_3_label" tabindex="0">
          Networks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_6_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6_3">
          <span class="md-nav__icon md-icon"></span>
          Networks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hml.methods/networks/mlps/" class="md-nav__link">
        MLP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          hml.metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        hml.metrics
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hml.metrics.MaxSignificance" class="md-nav__link">
    MaxSignificance
  </a>
  
    <nav class="md-nav" aria-label="MaxSignificance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hml.metrics.MaxSignificance.update_state" class="md-nav__link">
    update_state()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hml.metrics.MaxSignificance.result" class="md-nav__link">
    result()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hml.metrics.MaxSignificance.reset_state" class="md-nav__link">
    reset_state()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hml.metrics.RejectionAtEfficiency" class="md-nav__link">
    RejectionAtEfficiency
  </a>
  
    <nav class="md-nav" aria-label="RejectionAtEfficiency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hml.metrics.RejectionAtEfficiency.update_state" class="md-nav__link">
    update_state()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hml.metrics.RejectionAtEfficiency.result" class="md-nav__link">
    result()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hml.metrics.RejectionAtEfficiency.reset_state" class="md-nav__link">
    reset_state()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hml.metrics.MaxSignificance" class="md-nav__link">
    MaxSignificance
  </a>
  
    <nav class="md-nav" aria-label="MaxSignificance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hml.metrics.MaxSignificance.update_state" class="md-nav__link">
    update_state()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hml.metrics.MaxSignificance.result" class="md-nav__link">
    result()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hml.metrics.MaxSignificance.reset_state" class="md-nav__link">
    reset_state()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hml.metrics.RejectionAtEfficiency" class="md-nav__link">
    RejectionAtEfficiency
  </a>
  
    <nav class="md-nav" aria-label="RejectionAtEfficiency">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hml.metrics.RejectionAtEfficiency.update_state" class="md-nav__link">
    update_state()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hml.metrics.RejectionAtEfficiency.result" class="md-nav__link">
    result()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hml.metrics.RejectionAtEfficiency.reset_state" class="md-nav__link">
    reset_state()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>hml.metrics</h1>

<div class="doc doc-object doc-module">



  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="hml.metrics.MaxSignificance" class="doc doc-heading">
        <span class="doc doc-object-name doc-class-name">MaxSignificance</span>


<a href="#hml.metrics.MaxSignificance" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="keras.metrics.Metric">Metric</span></code></p>

  
      <p>Calculate the maximum significance of a model's predictions.</p>
<p>The significance is obtained by correctly identified signal events and incorrectly identified
background events (tagged as signal). The formula taken here is:</p>
<div class="arithmatex">\[
\mathrm{significance} = \sqrt{2 \left( (S + B) \ln \left( 1 + \frac{S}{B} \right) - S \right)}
\]</div>
<p>where <span class="arithmatex">\(S\)</span> is the number of correctly identified signal events (true positive) and <span class="arithmatex">\(B\)</span> is the
number of incorrectly identified background events (false positive). Methods usually give
probabilities for each class, so a threshold is needed to decide whether an event is signal or
background. As a result, one threshold corresponds to one significance value. This is why this
metric is called <code>MaxSignificance</code>: it calculates the maximum significance value among all the
thresholds.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>n_thresholds</code></td>
          <td class="doc-param-details">
            <p>Number of thresholds to use to compute the significance. The thresholds are uniformly
distributed in the [0, 1] range. The default is 101.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>101</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>class_id</code></td>
          <td class="doc-param-details">
            <p>Class ID of the signal class. The default is 1.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>1</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td class="doc-param-details">
            <p>Name of the metric. The default is "max_significance".</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>&#39;max_significance&#39;</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>dtype</code></td>
          <td class="doc-param-details">
            <p>Data type of the metric. The default is tf.float32.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="tensorflow">tf</span>.<span title="tensorflow.dtypes">dtypes</span>.<span title="tensorflow.dtypes.DType">DType</span>, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>tf.float32</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>ATTRIBUTE</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>thresholds</code></td>
          <td class="doc-attribute-details">
            <p>List of thresholds used to compute the significance.</p>
            <p>
                <span class="doc-attribute-annotation">
                  <b>TYPE:</b>
                    <code>list[float]</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td class="doc-attribute-details">
            <p>Threshold that gives the maximum significance.</p>
            <p>
                <span class="doc-attribute-annotation">
                  <b>TYPE:</b>
                    <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>threshold_index</code></td>
          <td class="doc-attribute-details">
            <p>Index of the threshold that gives the maximum significance.</p>
            <p>
                <span class="doc-attribute-annotation">
                  <b>TYPE:</b>
                    <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>max_significance</code></td>
          <td class="doc-attribute-details">
            <p>Maximum significance value.</p>
            <p>
                <span class="doc-attribute-annotation">
                  <b>TYPE:</b>
                    <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <p>Standalone usage:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">MaxSignificance</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">update_state</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="go">0.87897015</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">MaxSignificance</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span>
<span class="gp">... </span>   <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
<span class="gp">... </span>   <span class="p">[[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="go">0.87897015</span>
</code></pre></div>
    <p>Usage with <code>compile</code> API:</p>
<pre><code class="language-python">model.compile(
    metrics=[MaxSignificance()],
)
</code></pre>


        <details class="quote">
          <summary>Source code in <code>hml/metrics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_keras_serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">MaxSignificance</span><span class="p">(</span><span class="n">Metric</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the maximum significance of a model&#39;s predictions.</span>

<span class="sd">    The significance is obtained by correctly identified signal events and incorrectly identified</span>
<span class="sd">    background events (tagged as signal). The formula taken here is:</span>

<span class="sd">    $$</span>
<span class="sd">    \\mathrm{significance} = \\sqrt{2 \\left( (S + B) \\ln \\left( 1 + \\frac{S}{B} \\right) - S \\right)}</span>
<span class="sd">    $$</span>

<span class="sd">    where $S$ is the number of correctly identified signal events (true positive) and $B$ is the</span>
<span class="sd">    number of incorrectly identified background events (false positive). Methods usually give</span>
<span class="sd">    probabilities for each class, so a threshold is needed to decide whether an event is signal or</span>
<span class="sd">    background. As a result, one threshold corresponds to one significance value. This is why this</span>
<span class="sd">    metric is called `MaxSignificance`: it calculates the maximum significance value among all the</span>
<span class="sd">    thresholds.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_thresholds : int, optional</span>
<span class="sd">        Number of thresholds to use to compute the significance. The thresholds are uniformly</span>
<span class="sd">        distributed in the [0, 1] range. The default is 101.</span>
<span class="sd">    class_id : int, optional</span>
<span class="sd">        Class ID of the signal class. The default is 1.</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        Name of the metric. The default is &quot;max_significance&quot;.</span>
<span class="sd">    dtype : tf.dtypes.DType, optional</span>
<span class="sd">        Data type of the metric. The default is tf.float32.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    thresholds : list[float]</span>
<span class="sd">        List of thresholds used to compute the significance.</span>
<span class="sd">    threshold : tf.Tensor</span>
<span class="sd">        Threshold that gives the maximum significance.</span>
<span class="sd">    threshold_index : tf.Tensor</span>
<span class="sd">        Index of the threshold that gives the maximum significance.</span>
<span class="sd">    max_significance : tf.Tensor</span>
<span class="sd">        Maximum significance value.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Standalone usage:</span>
<span class="sd">    &gt;&gt;&gt; m = MaxSignificance()</span>
<span class="sd">    &gt;&gt;&gt; m.update_state([0, 0, 1], [[0.8, 0.2], [0.3, 0.7], [0.4, 0.6]])</span>
<span class="sd">    &gt;&gt;&gt; m.result().numpy()</span>
<span class="sd">    0.87897015</span>
<span class="sd">    &gt;&gt;&gt; m = MaxSignificance()</span>
<span class="sd">    &gt;&gt;&gt; m.update_state(</span>
<span class="sd">    ...    [[1, 0], [1, 0], [0, 1]],</span>
<span class="sd">    ...    [[0.8, 0.2], [0.3, 0.7], [0.4, 0.6]],</span>
<span class="sd">    ... )</span>
<span class="sd">    &gt;&gt;&gt; m.result().numpy()</span>
<span class="sd">    0.87897015</span>

<span class="sd">    Usage with `compile` API:</span>
<span class="sd">    ```python</span>
<span class="sd">    model.compile(</span>
<span class="sd">        metrics=[MaxSignificance()],</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n_thresholds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">101</span><span class="p">,</span>
        <span class="n">class_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max_significance&quot;</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">DType</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

        <span class="c1"># Compute thresholds in [0, 1] range</span>
        <span class="c1"># If the number of thresholds is 1, then the threshold is 0.5 and this metric is equivalent</span>
        <span class="c1"># to the significance metric.</span>
        <span class="k">if</span> <span class="n">n_thresholds</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_thresholds</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_thresholds</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">+</span> <span class="n">thresholds</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">class_id</span> <span class="o">=</span> <span class="n">class_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;tp_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="s2">&quot;zeros&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_weight</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;fp_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="s2">&quot;zeros&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">y_true</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">y_pred</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">sample_weight</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the state of the metric in a batch-wise fashion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y_true : list | np.ndarray | tf.Tensor</span>
<span class="sd">            True labels.</span>
<span class="sd">        y_pred : list | np.ndarray | tf.Tensor</span>
<span class="sd">            Predicted values (probabilities).</span>
<span class="sd">        sample_weight : list | np.ndarray | tf.Tensor | None, optional</span>
<span class="sd">            Sample weights. The default is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert inputs to tensors</span>
        <span class="c1"># y_true should be a tensor of integers</span>
        <span class="c1"># y_pred and sample_weight follows self.dtype</span>
        <span class="n">y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sample_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">sample_weight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="c1"># Convert true labels to one-hot encoding if necessary</span>
        <span class="c1"># and ensure that the data type is the same as the predicted values</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">n_classes</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">proper_y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">proper_y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="c1"># Get predicted values according to the signal class</span>
        <span class="n">y_true_signal</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">proper_y_true</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_id</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">y_pred_signal</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_id</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Compute true positives and false positives for each threshold</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">):</span>
            <span class="n">y_pred_thresholded</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="n">y_pred_signal</span><span class="p">,</span> <span class="n">threshold</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sample_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span>
                    <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">y_true_signal</span> <span class="o">*</span> <span class="n">y_pred_thresholded</span><span class="p">)</span> <span class="o">*</span> <span class="n">sample_weight</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span>
                    <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y_true_signal</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_pred_thresholded</span><span class="p">)</span> <span class="o">*</span> <span class="n">sample_weight</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">y_true_signal</span> <span class="o">*</span> <span class="n">y_pred_thresholded</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span>
                    <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y_true_signal</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_pred_thresholded</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the maximum significance value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tf.Tensor</span>
<span class="sd">            Maximum significance value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add epsilon to avoid division by zero</span>
        <span class="n">significances</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">tf</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">s</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">))</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># Get the corresponding threshold and its index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold_index</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">significances</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_index</span><span class="p">)</span>

        <span class="c1"># Get the maximum significance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_significance</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_max</span><span class="p">(</span><span class="n">significances</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_significance</span>

    <span class="k">def</span> <span class="nf">reset_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the state of the metric for a new batch.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="hml.metrics.MaxSignificance.update_state" class="doc doc-heading">
        <span class="doc doc-object-name doc-function-name">update_state</span>


<a href="#hml.metrics.MaxSignificance.update_state" class="headerlink" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">update_state</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Update the state of the metric in a batch-wise fashion.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_true</code></td>
          <td class="doc-param-details">
            <p>True labels.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>list | <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span> | <span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>y_pred</code></td>
          <td class="doc-param-details">
            <p>Predicted values (probabilities).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>list | <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span> | <span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>sample_weight</code></td>
          <td class="doc-param-details">
            <p>Sample weights. The default is None.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>list | <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span> | <span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span> | None, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>None</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>hml/metrics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">y_true</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">y_pred</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_weight</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the state of the metric in a batch-wise fashion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y_true : list | np.ndarray | tf.Tensor</span>
<span class="sd">        True labels.</span>
<span class="sd">    y_pred : list | np.ndarray | tf.Tensor</span>
<span class="sd">        Predicted values (probabilities).</span>
<span class="sd">    sample_weight : list | np.ndarray | tf.Tensor | None, optional</span>
<span class="sd">        Sample weights. The default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert inputs to tensors</span>
    <span class="c1"># y_true should be a tensor of integers</span>
    <span class="c1"># y_pred and sample_weight follows self.dtype</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sample_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sample_weight</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">sample_weight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="c1"># Convert true labels to one-hot encoding if necessary</span>
    <span class="c1"># and ensure that the data type is the same as the predicted values</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">n_classes</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">proper_y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">proper_y_true</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

    <span class="c1"># Get predicted values according to the signal class</span>
    <span class="n">y_true_signal</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">proper_y_true</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_id</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y_pred_signal</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_id</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute true positives and false positives for each threshold</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">):</span>
        <span class="n">y_pred_thresholded</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">greater_equal</span><span class="p">(</span><span class="n">y_pred_signal</span><span class="p">,</span> <span class="n">threshold</span><span class="p">),</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sample_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">y_true_signal</span> <span class="o">*</span> <span class="n">y_pred_thresholded</span><span class="p">)</span> <span class="o">*</span> <span class="n">sample_weight</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y_true_signal</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_pred_thresholded</span><span class="p">)</span> <span class="o">*</span> <span class="n">sample_weight</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">y_true_signal</span> <span class="o">*</span> <span class="n">y_pred_thresholded</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign_add</span><span class="p">(</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">y_true_signal</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_pred_thresholded</span><span class="p">)</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="hml.metrics.MaxSignificance.result" class="doc doc-heading">
        <span class="doc doc-object-name doc-function-name">result</span>


<a href="#hml.metrics.MaxSignificance.result" class="headerlink" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">result</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the maximum significance value.</p>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Maximum significance value.</p>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>hml/metrics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the maximum significance value.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tf.Tensor</span>
<span class="sd">        Maximum significance value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Add epsilon to avoid division by zero</span>
    <span class="n">significances</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">s</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">tf</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">))</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Get the corresponding threshold and its index</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">threshold_index</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">significances</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_index</span><span class="p">)</span>

    <span class="c1"># Get the maximum significance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_significance</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_max</span><span class="p">(</span><span class="n">significances</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_significance</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="hml.metrics.MaxSignificance.reset_state" class="doc doc-heading">
        <span class="doc doc-object-name doc-function-name">reset_state</span>


<a href="#hml.metrics.MaxSignificance.reset_state" class="headerlink" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">reset_state</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Reset the state of the metric for a new batch.</p>

      <details class="quote">
        <summary>Source code in <code>hml/metrics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reset_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset the state of the metric for a new batch.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="hml.metrics.RejectionAtEfficiency" class="doc doc-heading">
        <span class="doc doc-object-name doc-class-name">RejectionAtEfficiency</span>


<a href="#hml.metrics.RejectionAtEfficiency" class="headerlink" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="keras.metrics.Metric">Metric</span></code></p>

  
      <p>Calculate the background rejection at a given signial efficiency.</p>
<p>This metric is for binary classification problems. The background rejection is the inverse of
the mistag rate, which is the fraction of background events that are incorrectly identified as
signal. The signal efficiency is the fraction of signal events that are correctly identified as
signal. The signal efficiency and the mistag rate are true positive and false positive rates.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>efficiency</code></td>
          <td class="doc-param-details">
            <p>Signal efficiency. The default is 0.5.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>float, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>0.5</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>n_thresholds</code></td>
          <td class="doc-param-details">
            <p>Number of thresholds to use to compute the rejection. The thresholds are uniformly
distributed in the [0, 1] range. The default is 101.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>101</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>class_id</code></td>
          <td class="doc-param-details">
            <p>Class ID of the signal class. The default is 1.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>1</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td class="doc-param-details">
            <p>Name of the metric. The default is "rejection_at_efficiency".</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>&#39;rejection_at_efficiency&#39;</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>dtype</code></td>
          <td class="doc-param-details">
            <p>Data type of the metric. The default is tf.float32.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="tensorflow">tf</span>.<span title="tensorflow.dtypes">dtypes</span>.<span title="tensorflow.dtypes.DType">DType</span>, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>tf.float32</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <p>Standalone usage:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">RejectionAtEfficiency</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span>
<span class="gp">... </span>   <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
<span class="gp">... </span>   <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]],</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
<span class="go">2.9999993</span>
</code></pre></div>


        <details class="quote">
          <summary>Source code in <code>hml/metrics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_keras_serializable</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">RejectionAtEfficiency</span><span class="p">(</span><span class="n">Metric</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the background rejection at a given signial efficiency.</span>

<span class="sd">    This metric is for binary classification problems. The background rejection is the inverse of</span>
<span class="sd">    the mistag rate, which is the fraction of background events that are incorrectly identified as</span>
<span class="sd">    signal. The signal efficiency is the fraction of signal events that are correctly identified as</span>
<span class="sd">    signal. The signal efficiency and the mistag rate are true positive and false positive rates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    efficiency : float, optional</span>
<span class="sd">        Signal efficiency. The default is 0.5.</span>
<span class="sd">    n_thresholds : int, optional</span>
<span class="sd">        Number of thresholds to use to compute the rejection. The thresholds are uniformly</span>
<span class="sd">        distributed in the [0, 1] range. The default is 101.</span>
<span class="sd">    class_id : int, optional</span>
<span class="sd">        Class ID of the signal class. The default is 1.</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        Name of the metric. The default is &quot;rejection_at_efficiency&quot;.</span>
<span class="sd">    dtype : tf.dtypes.DType, optional</span>
<span class="sd">        Data type of the metric. The default is tf.float32.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Standalone usage:</span>
<span class="sd">    &gt;&gt;&gt; m = RejectionAtEfficiency()</span>
<span class="sd">    &gt;&gt;&gt; m.update_state(</span>
<span class="sd">    ...    [[1, 0], [1, 0], [1, 0], [0, 1], [0, 1]],</span>
<span class="sd">    ...    [[1, 0], [0.7, 0.3], [0.2, 0.8], [0.7, 0.3], [0.2, 0.8]],</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; m.result().numpy()</span>
<span class="sd">    2.9999993</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">efficiency</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">n_thresholds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">101</span><span class="p">,</span>
        <span class="n">class_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rejection_at_efficiency&quot;</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">DType</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specificity_at_sensitivity</span> <span class="o">=</span> <span class="n">SpecificityAtSensitivity</span><span class="p">(</span>
            <span class="n">sensitivity</span><span class="o">=</span><span class="n">efficiency</span><span class="p">,</span>
            <span class="n">num_thresholds</span><span class="o">=</span><span class="n">n_thresholds</span><span class="p">,</span>
            <span class="n">class_id</span><span class="o">=</span><span class="n">class_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">y_true</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">y_pred</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">sample_weight</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the state of the metric in a batch-wise fashion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y_true : list | np.ndarray | tf.Tensor</span>
<span class="sd">            True labels.</span>
<span class="sd">        y_pred : list | np.ndarray | tf.Tensor</span>
<span class="sd">            Predicted values (probabilities).</span>
<span class="sd">        sample_weight : list | np.ndarray | tf.Tensor | None, optional</span>
<span class="sd">            Sample weights. The default is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specificity_at_sensitivity</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">sample_weight</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the background rejection at the given signal efficiency.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tf.Tensor</span>
<span class="sd">            Background rejection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Specificity is the true negative rate: tn / (tn + fp).</span>
        <span class="c1"># Sensitivity is the true positive rate: tp / (tp + fn).</span>
        <span class="c1"># Background rejection is the inverse of 1 - specificity.</span>
        <span class="c1"># Signal efficiency is the same as sensitivity.</span>
        <span class="n">specificity</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">specificity_at_sensitivity</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="n">rejection</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">specificity</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">epsilon</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">rejection</span>

    <span class="k">def</span> <span class="nf">reset_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the state of the metric for a new batch.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specificity_at_sensitivity</span><span class="o">.</span><span class="n">reset_states</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="hml.metrics.RejectionAtEfficiency.update_state" class="doc doc-heading">
        <span class="doc doc-object-name doc-function-name">update_state</span>


<a href="#hml.metrics.RejectionAtEfficiency.update_state" class="headerlink" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">update_state</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Update the state of the metric in a batch-wise fashion.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_true</code></td>
          <td class="doc-param-details">
            <p>True labels.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>list | <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span> | <span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>y_pred</code></td>
          <td class="doc-param-details">
            <p>Predicted values (probabilities).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>list | <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span> | <span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>sample_weight</code></td>
          <td class="doc-param-details">
            <p>Sample weights. The default is None.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>list | <span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span> | <span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span> | None, optional</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>None</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>hml/metrics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">y_true</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">y_pred</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">sample_weight</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the state of the metric in a batch-wise fashion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y_true : list | np.ndarray | tf.Tensor</span>
<span class="sd">        True labels.</span>
<span class="sd">    y_pred : list | np.ndarray | tf.Tensor</span>
<span class="sd">        Predicted values (probabilities).</span>
<span class="sd">    sample_weight : list | np.ndarray | tf.Tensor | None, optional</span>
<span class="sd">        Sample weights. The default is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">specificity_at_sensitivity</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">sample_weight</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="hml.metrics.RejectionAtEfficiency.result" class="doc doc-heading">
        <span class="doc doc-object-name doc-function-name">result</span>


<a href="#hml.metrics.RejectionAtEfficiency.result" class="headerlink" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">result</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Return the background rejection at the given signal efficiency.</p>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code><span title="tensorflow">tf</span>.<span title="tensorflow.Tensor">Tensor</span></code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Background rejection.</p>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>hml/metrics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the background rejection at the given signal efficiency.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tf.Tensor</span>
<span class="sd">        Background rejection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Specificity is the true negative rate: tn / (tn + fp).</span>
    <span class="c1"># Sensitivity is the true positive rate: tp / (tp + fn).</span>
    <span class="c1"># Background rejection is the inverse of 1 - specificity.</span>
    <span class="c1"># Signal efficiency is the same as sensitivity.</span>
    <span class="n">specificity</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">specificity_at_sensitivity</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
    <span class="n">rejection</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">specificity</span> <span class="o">+</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">epsilon</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">rejection</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="hml.metrics.RejectionAtEfficiency.reset_state" class="doc doc-heading">
        <span class="doc doc-object-name doc-function-name">reset_state</span>


<a href="#hml.metrics.RejectionAtEfficiency.reset_state" class="headerlink" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">reset_state</span><span class="p">()</span>
</code></pre></div>

  <div class="doc doc-contents ">
  
      <p>Reset the state of the metric for a new batch.</p>

      <details class="quote">
        <summary>Source code in <code>hml/metrics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reset_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset the state of the metric for a new batch.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">specificity_at_sensitivity</span><span class="o">.</span><span class="n">reset_states</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>